###################################################
#						  #
# THIS CONFIGURATION FILE IS TARGETED AT SESC.CC, # 
# FROM THE LIBCC DIRECTORY                        #
#						  #
###################################################

#Basic parameters for system

gNetwork      = 'ppc970_net'
procsPerNode  = 1
issue         = 4
pageSize      = 4096
issueWrongPath = true

nCPUs         = 16
cpucore[0:15] = 'ppc970'
enableICache  = true

[AdvMemMap]
MapType       = 'strided'
log2TileSize  = 32-2
useNetwork    = false

#lean Power 4

[ppc970]
frequency       = 2e9
inorder         = false
fetchWidth      = 8
instQueueSize   = 16
issueWidth      = 4
retireWidth     = 8
decodeDelay     = 6
renameDelay     = 3
wakeupDelay     = 6  # 17 cycles BPenalty
maxBranches     = 32 
bb4Cycle        = 1
maxIRequests    = 4
interClusterLat = 2
intraClusterLat = 1
cluster[0]      = 'FXCluster_970'
cluster[1]      = 'FPCluster_970'
stForwardDelay  = 2  # Same as D-Cache more likely
maxLoads        = 64
maxStores       = 64
robSize         = 192
intRegs         = 128 # Just playing
fpRegs          = 128 # Just playing
bpred           = 'HybridPlusBP'
dataSource      = "AdvMemory DL1"
instrSource     = "AdvMemory IL1"
dtlb           = 'FXDTLB'
itlb           = 'FXITLB'
OSType          = 'dummy'

[FXDTLB]
deviceType='tlb'
size =  64*8
assoc = 64
bsize = 8
numPorts = 2
replPolicy = 'LRU'

[FXITLB]
deviceType = 'tlb'
size  = 32*8
assoc = 32
bsize = 8
numPorts = 1
replPolicy = 'LRU'

[FXCluster_970]
winSize     = 96        # window number of entries
recycleAt   = 'Execute' # Recycle entries at : Execute|Retire
iStoreLat   = 2
iStoreUnit  = 'LDST_970'
iLoadLat    = 2
iLoadUnit   = 'LDST_970'
iALULat     = 1
iALUUnit    = 'ALU_970'
iBJLat      = 1
iBJUnit     = 'ALU_970'
iDivLat     = 12
iDivUnit    = 'MultDiv_970'
iMultLat    = 4
iMultUnit   = 'MultDiv_970'

[LDST_970]
Num         = 2   # Number of units
Occ         = 1   # Occupancy per unit (1 means fully pipelined)

[ALU_970]
Num         = 2   # Number of units
Occ         = 1   # Occupancy per unit (1 means fully pipelined)

[MultDiv_970]
Num         = 1   # Number of units
Occ         = 1   # Occupancy per unit (1 means fully pipelined)

[FPCluster_970]
winSize     = 64        # window number of entries
recycleAt   = 'Retire'  # Recycle entries at : Execute|Retire
fpALULat    = 1
fpALUUnit   = 'FP0_970'
fpMultLat   = 2
fpMultUnit  = 'FP0_970'
fpDivLat    = 10
fpDivUnit   = 'FP0_970'

[FP0_970]
Num         = 2
Occ         = 1

[HybridPlusBP]
type           = "hybrid" 
BTACDelay      = 4
l1size         = 1
l2size         = 16*1024
l2Bits	       = 1
historySize    = 11
Metasize       = 16*1024
Metabits       = 2
localSize      = 16*1024
localBits      = 2
btbSize        = 4096
btbBsize       = 1
btbAssoc       = 4
btbReplPolicy  = 'LRU'
btbHistory     = 0
rasSize        = 0 # 32 is realistic

#################################################################
### Cache Memory

[AdvMemory]
highest        = true
deviceType     = 'mpCache'
size           = 16*1024
assoc          = 2
ldStBufSize    = 4
bsize          = 32
writePolicy    = 'WBCoherent'
replPolicy     = 'LRU'
numPorts       = 64
portOccp       = 1
readDelay      = 2
missDelay      = 1
hitDelay       = 1
MSHRsize       = 16
MSHRtype       = 'full'
ReportEviction = false
#lowerLevel    = 'BigMem'
lowerLevel     = "AdvMemoryL2 L2"

[AdvMemoryL2]
highest        = false
deviceType     = 'mpCache'
size           = 512*1024
assoc          = 4
ldStBufSize    = 4
bsize          = 32
writePolicy    = 'WBCoherent'
replPolicy     = 'LRU'
numPorts       = 64
portOccp       = 1
readDelay      = 11
missDelay      = 1
hitDelay       = 1
MSHRsize       = 64
MSHRtype       = 'full'
ReportEviction = true     #MUST BE SET FOR MPCACHE touching Slave Protocol
#lowerLevel    = 'perfectCache'
lowerLevel     = 'CacheCoherenceSlave'

[CacheCoherenceSlave]
deviceType     = 'SlaveMPProt'
localPort      = 1

[CacheCoherenceMaster]
deviceType     = 'MasterMPCoh'
directory      = 'CoherenceDirectory'
victimDir      = 'VictimDirectory'	
lowerLevel     = 'AdvMemoryL3'
localPort      = 2  # TODO

[CoherenceDirectory]
size           = 4096*1024 #128k original
assoc          = 8
bsize          = 32
replPolicy     = 'LRU'
numPorts       = 1
portOccp       = 1
readDelay      = 2
missDelay      = 1
MSHRsize       = 4
MSHRtype    = 'full'

#NOTE WELL: This victim dir must be fully associative
[VictimDirectory]
size           = 8*1024
assoc          = 8*32
bsize          = 32
slack          = 32
replPolicy     = 'LRU'
numPorts       = 1
portOccp       = 1
readDelay      = 2
missDelay      = 1
MSHRsize       = 4
MSHRtype       = 'full'

[AdvMemoryL3]
highest        = false       #Should be false for Cache touching Master MPCoh
deviceType     = 'mpcache'
size           = 64*1024 #64
assoc          = 4
bsize          = 32
writePolicy    = 'WBCoherent'
replPolicy     = 'LRU'
numPorts       = 1
portOccp       = 1
readDelay      = 4
missDelay      = 1
hitDelay       = 1
MSHRsize       = 64
MSHRtype       = 'full'
ldStBufSize    = 8
ReportEviction = false
lowerLevel     = 'AdvMem'

#################################################################
### Main Memory

[AdvMem]
deviceType  = 'bus'
busCmd      = 3  # 3.2GHz : cycles to sync frequency (0-7)
busData     = 32 # 3.2GHz : 128/32 =  4 B/cycle -> 3.2GHz proc -> 12.8GB/s
numPorts    = 4
portOccp    = 2
delay       = 3
lowerLevel  = "BigMem"

[BigMem]
deviceType    = 'niceCache'
size          = 1024
assoc         = 8
bsize         = 64
writePolicy   = 'WB'
replPolicy    = 'LRU'
numPorts      = 1
portOccp      = 1
readDelay     = 400-32   # 3.2GHz: 70ns is 224 cycles -32 busData
missDelay     = 160
hitDelay      = 160
MSHRsize      = 32
MSHRtype      = 'full'
lowerLevel    = "voidDevice"

[voidDevice]
deviceType  =   'void'

#################################################################
### Network

[ppc970_net]
############################################
# Overall parameters
fixMessagePath = false   # Packets from A to B always follow the same path
congestionFree = false   # Do not model the routers, a fix time for each packet (addFixTime)
addFixDelay    = 1       # Fix delay added to all the packets sent
type           = 'full'  # mesh, hypercube...
############################################
# Router parameters
crossLat       = 1       # Crossing Latency  : Time for a message to go through the router
WireLat	       = 40	 # Port latency for neighbours		
############################################
# Local port parameters
localNum       = 2       # Number of addressable local ports
localPort      = 1       # Number of ports for each addressable local port
localLat       = 1       # Local port Latency 
localOcc       = 1       # Local port Occupancy (0 means unlimited)
############################################
# Mesh parameters
width          = 4       # the width of network (totalNum = width * width)
linkBits       = 96      # Port width in bits (12=96bits)

[AT]
transPenalty = 5         # penalty for starting/stopping sections=======

##############################
#     BEGIN TASKSCALAR       #
##############################
[TaskScalar]
VersionSize   = 32          # Version size (HVersion) in bits
SyncOnRestart =  3          # Number of restarts before wait to become safe
MLThreshold   = 8  # Merge Last  Threshold Safe thread
MFThreshold   = $(nCPUs)    # Merge First Threshold Safe thread
IDP           = 'IntPred1'  # Interval Predictor
bsize         = 64          # Versioned cache line size

################################
# IDP: Interval Distribution Predictor (one per processor)
[IntPred1]
deviceType   = 'cache' 
IDPnChildMax = 4     # 4 default value, 0 means no prediction
size         = 32*8  # 32 entries
bSize        = 8
Assoc        = 32
ReplPolicy   = 'LRU'
numPorts     = 1
portOccp     = 1
